import{S as f}from"./ServiceCampusNetLoginController-72a73e7b.js";import{_ as Y,f as r,g as L,h as j,r as g,o as c,c as u,a,X as d,d as s,w as i,b as p,U as $,V as G,aE as K,Z as x}from"./index-3fbeb961.js";import{s as X,a as Z}from"./function-call-59ce459f.js";import"./index-143c7f7f.js";import{s as l}from"./index-17b9c811.js";const q={class:"detailed-page"},J={class:"section logs-section"},Q={class:"section__header"},W={style:{"font-size":"12px",color:"#8fa1c1"}},ee={class:"section__actions"},te={class:"log-box",role:"log","aria-label":"服务日志"},oe={class:"log-head"},ae={class:"time"},ne={key:0,class:"log-body"},se={key:1,class:"log-empty"},ie={class:"section actions-section"},le={class:"actions"},re={class:"schedule-row"},ce="campus_net_login_time",ue={__name:"CampusNetLoginDetailed",setup(de){const k=r([]);function D(e){return!e||typeof e!="object"?{}:{id:e.id,relationTable:e.relationTable??e.relation_table,email:e.email,createTime:e.createTime??e.create_time,operationName:e.operationName??e.operation_name,operationStatus:e.operationStatus??e.operation_status,remarks:e.remarks}}const T=L(()=>(k.value||[]).map(D));function V(e){if(!e)return"";const t=typeof e=="string"||typeof e=="number"?new Date(e):e;if(!(t instanceof Date)||isNaN(t.getTime()))return String(e);const n=v=>String(v).padStart(2,"0");return`${t.getFullYear()}-${n(t.getMonth()+1)}-${n(t.getDate())} ${n(t.getHours())}:${n(t.getMinutes())}:${n(t.getSeconds())}`}function E(e){return e===1||e===!0?"成功":e===0||e===!1?"失败":""}function z(e){return e===1||e===!0?"ok":e===0||e===!1?"fail":""}async function b(){const e=await f.logs({loading:"加载中"});k.value=Array.isArray(e)?e:[]}async function y(){try{await b(),l("已刷新日志")}catch{l("刷新失败，请稍后重试")}}async function B(){try{await f.connect({loading:"连接中"}),l("连接操作已发送，请查看日志"),await y()}catch{l("连接失败，请稍后重试")}}async function M(){try{await X({title:"确认下线",message:"确定要下线校园网吗？当前连接将被断开。",confirmButtonText:"下线",cancelButtonText:"取消"})}catch{return}try{await f.logout({loading:"下线中"}),l("下线操作已发送，请查看日志"),await y()}catch{l("下线失败，请稍后重试")}}const m=r(!1),h=r(""),C=L(()=>h.value?`每日 ${h.value}`:"未设置"),w=r(!1);function U(){m.value=!0}async function H(e){const t=e.selectedOptions[0].value,n=e.selectedOptions[1].value,v=await f.setRunningTime(t,n,{loading:"设置中"});l(v),m.value=!1,await N()}function O(){try{const e=localStorage.getItem(ce);typeof e=="string"&&/^\d{2}:\d{2}$/.test(e)&&(h.value=e)}catch{}}const A=["hour","minute"],_=r(),R=()=>{Z({title:"帮助",message:"该服务通过“自动下线校园网再上线”的方式，来刷新校园网在线时长。一般情况下，校园网会在上一次连接成功后约 48 小时自动断开连接。可设置刷新间隔来防止断线。"}).then(()=>{})},S=r(),N=async()=>{const t=(await f.view({loading:"加载中"})).refreshTime.split("-");_.value=[t[0],t[1]],S.value=`重置登录时间为每天的${_.value[0]}:${_.value[1]}`};return j(async()=>{await b(),O(),await N()}),(e,t)=>{const n=g("van-button"),v=g("van-tag"),F=g("van-popover"),I=g("van-time-picker"),P=g("van-popup");return c(),u("div",q,[a("div",J,[a("div",Q,[t[5]||(t[5]=a("div",{class:"section__title"},"服务日志",-1)),a("div",W,d(S.value),1),a("div",ee,[s(n,{size:"small",plain:"",type:"primary",onClick:y},{default:i(()=>[...t[4]||(t[4]=[p("刷新",-1)])]),_:1})])]),a("div",te,[T.value.length?(c(!0),u($,{key:0},G(T.value,o=>(c(),u("div",{class:"log-item",key:o.id||o.createTime+"-"+o.operationName},[a("div",oe,[a("span",ae,d(V(o.createTime)),1),s(v,{class:"op-name-tag",type:"primary",size:"small",plain:""},{default:i(()=>[p(d(o.operationName),1)]),_:2},1024),a("span",{class:K(["status",z(o.operationStatus)])},d(E(o.operationStatus)),3)]),o.remarks?(c(),u("div",ne,d(o.remarks),1)):x("",!0)]))),128)):(c(),u("div",se,"暂无日志"))])]),a("div",ie,[a("div",le,[s(n,{type:"primary",block:"",round:"",onClick:B},{default:i(()=>[...t[6]||(t[6]=[p("连接校园网",-1)])]),_:1}),s(n,{type:"danger",block:"",round:"",onClick:M},{default:i(()=>[...t[7]||(t[7]=[p("下线校园网",-1)])]),_:1}),a("div",re,[s(n,{type:"default",block:"",round:"",onClick:U},{default:i(()=>[t[8]||(t[8]=p(" 设置重置登录时间 ",-1)),C.value?(c(),u($,{key:0},[p("（"+d(C.value)+"）",1)],64)):x("",!0)]),_:1}),s(F,{show:w.value,"onUpdate:show":t[0]||(t[0]=o=>w.value=o),placement:"bottom",overlay:!1,trigger:"click"},{reference:i(()=>[a("span",{class:"help-badge","aria-label":"功能说明",onClick:R},"?")]),_:1},8,["show"])])])]),s(P,{show:m.value,"onUpdate:show":t[3]||(t[3]=o=>m.value=o),round:"",position:"bottom"},{default:i(()=>[s(I,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),title:"选择刷新时间·每天","columns-type":A,"show-toolbar":"",onConfirm:H,onCancel:t[2]||(t[2]=o=>m.value=!1)},null,8,["modelValue"])]),_:1},8,["show"])])}}},ge=Y(ue,[["__scopeId","data-v-d9aec82b"]]);export{ge as default};
