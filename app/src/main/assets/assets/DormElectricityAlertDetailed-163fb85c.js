import{s as i}from"./index-b27b16a4.js";import{S as v}from"./ServiceDormElectricityAlertController-4f3d1d8e.js";import{_ as R,f as n,g as D,h as Y,r as c,o as u,c as d,a,X as m,d as l,w as r,b as g,U as j,V as q,aF as G,a0 as K}from"./index-04865497.js";import{a as O}from"./function-call-a27a8b28.js";import"./index-16586b91.js";const P={class:"detailed-page"},X={class:"section logs-section"},J={class:"section__header"},Q={style:{"font-size":"12px",color:"#8fa1c1"}},W={class:"section__actions"},Z={class:"log-box",role:"log","aria-label":"服务日志"},ee={class:"log-head"},te={class:"time"},oe={key:0,class:"log-body"},ae={key:1,class:"log-empty"},se={class:"section actions-section"},ne={class:"actions"},le={class:"schedule-row"},ie="campus_net_login_time",re={__name:"DormElectricityAlertDetailed",setup(ce){const T=n([]);function x(e){return!e||typeof e!="object"?{}:{id:e.id,relationTable:e.relationTable??e.relation_table,email:e.email,createTime:e.createTime??e.create_time,operationName:e.operationName??e.operation_name,operationStatus:e.operationStatus??e.operation_status,remarks:e.remarks}}const k=D(()=>(T.value||[]).map(x));function E(e){if(!e)return"";const t=typeof e=="string"||typeof e=="number"?new Date(e):e;if(!(t instanceof Date)||isNaN(t.getTime()))return String(e);const s=S=>String(S).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}:${s(t.getSeconds())}`}function $(e){return e===1||e===!0?"成功":e===0||e===!1?"失败":""}function V(e){return e===1||e===!0?"ok":e===0||e===!1?"fail":""}async function h(){const e=await v.logs({loading:"加载中"});T.value=Array.isArray(e)?e:[]}async function A(){try{await h(),i("已刷新日志")}catch{i("刷新失败，请稍后重试")}}n(!1);const y=n("");D(()=>y.value?`每日 ${y.value}`:"未设置");const N=n(!1);function L(){try{const e=localStorage.getItem(ie);typeof e=="string"&&/^\d{2}:\d{2}$/.test(e)&&(y.value=e)}catch{}}n();const z=()=>{O({title:"帮助",message:"该服务每6小时会查询一次电量，若当前电量低于设置的阈值，则会发送预警邮件通知。"}).then(()=>{})},w=n(),_=n(20),p=n(!1),f=n(""),b=n(!1),C=async()=>{const e=await v.view({loading:"加载中..."});if(w.value=`当前设置的预警电量阈值为 ${e.threshold} 度`,e&&typeof e.threshold<"u"&&e.threshold!==null){const t=Number(e.threshold);Number.isNaN(t)||(_.value=t)}},F=async()=>{await v.queryCurrentElectricity({loading:"查询中..."}),await h()},M=async()=>{f.value=Number.isFinite(_.value)?String(_.value):"",p.value=!0},U=async()=>{const e=String(f.value??"").trim();if(!e){i("请输入阈值");return}const t=Number(e);if(!Number.isFinite(t)||t<0){i("请输入有效的阈值");return}b.value=!0;try{await v.setThreshold(t,{loading:"设置中..."}),_.value=t,i("阈值设置成功"),p.value=!1,await C()}catch{i("设置失败，请稍后重试")}finally{b.value=!1}};return Y(async()=>{await h(),L(),await C()}),(e,t)=>{const s=c("van-button"),S=c("van-tag"),H=c("van-popover"),B=c("van-field"),I=c("van-dialog");return u(),d("div",P,[a("div",X,[a("div",J,[t[4]||(t[4]=a("div",{class:"section__title"},"服务日志",-1)),a("div",Q,m(w.value),1),a("div",W,[l(s,{size:"small",plain:"",type:"primary",onClick:A},{default:r(()=>[...t[3]||(t[3]=[g("刷新",-1)])]),_:1})])]),a("div",Z,[k.value.length?(u(!0),d(j,{key:0},q(k.value,o=>(u(),d("div",{class:"log-item",key:o.id||o.createTime+"-"+o.operationName},[a("div",ee,[a("span",te,m(E(o.createTime)),1),l(S,{class:"op-name-tag",type:"primary",size:"small",plain:""},{default:r(()=>[g(m(o.operationName),1)]),_:2},1024),a("span",{class:G(["status",V(o.operationStatus)])},m($(o.operationStatus)),3)]),o.remarks?(u(),d("div",oe,m(o.remarks),1)):K("",!0)]))),128)):(u(),d("div",ae,"暂无日志"))])]),a("div",se,[a("div",ne,[l(s,{type:"primary",block:"",round:"",onClick:F},{default:r(()=>[...t[5]||(t[5]=[g("查询当前电量",-1)])]),_:1}),a("div",le,[l(s,{type:"default",block:"",round:"",onClick:M},{default:r(()=>[...t[6]||(t[6]=[g(" 设置预警电量阈值 ",-1)])]),_:1}),l(H,{show:N.value,"onUpdate:show":t[0]||(t[0]=o=>N.value=o),placement:"bottom",overlay:!1,trigger:"click"},{reference:r(()=>[a("span",{class:"help-badge","aria-label":"功能说明",onClick:z},"?")]),_:1},8,["show"])])])]),l(I,{show:p.value,"onUpdate:show":t[2]||(t[2]=o=>p.value=o),title:"设置预警电量阈值","show-cancel-button":"","confirm-button-text":"确认","cancel-button-text":"取消","confirm-button-loading":b.value,onConfirm:U},{default:r(()=>[l(B,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),type:"digit",placeholder:"请输入阈值（单位：度）",clearable:""},null,8,["modelValue"])]),_:1},8,["show","confirm-button-loading"])])}}},fe=R(re,[["__scopeId","data-v-1bbc5dc5"]]);export{fe as default};
