import{c as k}from"./campus-9741dcdb.js";import{S as O}from"./ServiceDormElectricityAlertController-4f3d1d8e.js";import{_ as z,f as t,Z as F,g as h,u as R,r as g,o as Z,c as j,d as u,w as V,b as q,aE as G}from"./index-04865497.js";import{s}from"./index-b27b16a4.js";const H={class:"dorm-electricity-alert"},J={__name:"DormElectricityAlert",setup(K){const A=Array.isArray(k)?k:[],B=A.map(e=>{const n=(e==null?void 0:e.name)||(e==null?void 0:e.text)||"",o=(e==null?void 0:e.value)!=null?String(e.value):"";return n&&o?{text:n,value:o}:null}).filter(Boolean),c=t(!1),i=t(!1),f=t(!1),v=t([]),d=t(!1),p=t(!1);let b=0;const r=F({campusName:"",campusValue:"",buildingName:"",buildingValue:"",roomName:"",roomValue:""}),S=h(()=>r.campusValue?r.buildingValue?d.value?"房间加载中...":p.value&&v.value.length===0?"暂无房间数据":"请选择房间":"请先选择楼栋":"请先选择校区"),N=h(()=>{const e=A.find(n=>String((n==null?void 0:n.value)??"")===r.campusValue);return e?(e.buildings||[]).map(n=>{const o=(n==null?void 0:n.name)||(n==null?void 0:n.text)||"",a=(n==null?void 0:n.value)!=null?String(n.value):"";return o&&a?{text:o,value:a}:null}).filter(Boolean):[]});R(()=>r.campusValue,()=>{r.buildingName="",r.buildingValue="",x()}),R(()=>r.buildingValue,e=>{x(),e&&C()});function x(){r.roomName="",r.roomValue="",v.value=[],p.value=!1}function E(e){const n=Array.isArray(e==null?void 0:e.selectedOptions)?e.selectedOptions[0]:e;r.campusName=(n==null?void 0:n.text)||"",r.campusValue=(n==null?void 0:n.value)||"",c.value=!1}function U(e){const n=Array.isArray(e==null?void 0:e.selectedOptions)?e.selectedOptions[0]:e;r.buildingName=(n==null?void 0:n.text)||"",r.buildingValue=(n==null?void 0:n.value)||"",i.value=!1}function P(e){const n=Array.isArray(e==null?void 0:e.selectedOptions)?e.selectedOptions[0]:e;r.roomName=(n==null?void 0:n.text)||"",r.roomValue=(n==null?void 0:n.value)||"",f.value=!1}function D(){if(!r.campusValue)return s("请先选择校区");if(!r.buildingValue)return s("请先选择楼栋");!p.value&&!d.value&&C(),f.value=!0}function L(){if(!r.campusValue){s("请先选择校区");return}if(N.value.length===0){s("当前校区暂无楼栋数据");return}i.value=!0}const T=async()=>{if(!r.roomValue)return s("请先选择房间");const e=await O.bindRoom({campus:r.campusValue,campusName:r.campusName,building:r.buildingValue,buildingName:r.buildingName,room:r.roomValue,roomName:r.roomName},{loading:"绑定中..."});s(e),window.location.href="index.html"};async function C(){if(!r.campusValue||!r.buildingValue)return;const e=++b;d.value=!0;try{const n=await O.rooms(r.campusValue,r.buildingValue);if(b!==e)return;const o=$(n);v.value=o}catch(n){b===e&&(v.value=[],n!=null&&n.message&&s(n.message))}finally{b===e&&(d.value=!1,p.value=!0)}}function $(e){return I(e).map(o=>{const a=(o==null?void 0:o.text)||(o==null?void 0:o.name)||(o==null?void 0:o.label)||(o==null?void 0:o.roomName)||"",w=(o==null?void 0:o.value)??(o==null?void 0:o.code)??(o==null?void 0:o.id)??(o==null?void 0:o.roomId)??(typeof(o==null?void 0:o.text)=="string"?o.text:"")??(typeof(o==null?void 0:o.name)=="string"?o.name:""),m=w!=null?String(w):"";return{text:a,value:m}}).filter(o=>o.text&&o.value!=="")}function I(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.list)?e.list:Array.isArray(e==null?void 0:e.rows)?e.rows:Array.isArray(e==null?void 0:e.records)?e.records:[]}return(e,n)=>{const o=g("van-field"),a=g("van-button"),w=g("van-cell-group"),m=g("van-picker"),_=g("van-popup");return Z(),j("div",H,[u(w,{inset:"",class:"dorm-electricity-alert__group"},{default:V(()=>[u(o,{modelValue:r.campusName,"onUpdate:modelValue":n[0]||(n[0]=l=>r.campusName=l),label:"校区",placeholder:"请选择校区","is-link":"",readonly:"",onClick:n[1]||(n[1]=l=>c.value=!0)},null,8,["modelValue"]),u(o,{modelValue:r.buildingName,"onUpdate:modelValue":n[2]||(n[2]=l=>r.buildingName=l),label:"楼栋",placeholder:"请选择楼栋","is-link":"",readonly:"",onClick:L},null,8,["modelValue"]),u(o,{modelValue:r.roomName,"onUpdate:modelValue":n[3]||(n[3]=l=>r.roomName=l),label:"房间",placeholder:S.value,"is-link":"",readonly:"",onClick:D},null,8,["modelValue","placeholder"]),u(a,{type:"primary",class:"dorm-electricity-alert__submit",onClick:T},{default:V(()=>[...n[10]||(n[10]=[q(" 确认绑定 ",-1)])]),_:1})]),_:1}),u(_,{show:c.value,"onUpdate:show":n[5]||(n[5]=l=>c.value=l),round:"",position:"bottom"},{default:V(()=>[u(m,{title:"选择校区",columns:G(B),"show-toolbar":"",onConfirm:E,onCancel:n[4]||(n[4]=l=>c.value=!1)},null,8,["columns"])]),_:1},8,["show"]),u(_,{show:i.value,"onUpdate:show":n[7]||(n[7]=l=>i.value=l),round:"",position:"bottom"},{default:V(()=>[u(m,{title:"选择楼栋",columns:N.value,"show-toolbar":"",onConfirm:U,onCancel:n[6]||(n[6]=l=>i.value=!1)},null,8,["columns"])]),_:1},8,["show"]),u(_,{show:f.value,"onUpdate:show":n[9]||(n[9]=l=>f.value=l),round:"",position:"bottom"},{default:V(()=>[u(m,{title:"选择房间",columns:v.value,loading:d.value,"show-toolbar":"",onConfirm:P,onCancel:n[8]||(n[8]=l=>f.value=!1)},null,8,["columns","loading"])]),_:1},8,["show"])])}}},Y=z(J,[["__scopeId","data-v-12346990"]]);export{Y as default};
