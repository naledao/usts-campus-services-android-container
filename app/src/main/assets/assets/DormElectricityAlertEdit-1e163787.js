import{c as R}from"./campus-9741dcdb.js";import{S as _}from"./ServiceDormElectricityAlertController-4f3d1d8e.js";import{_ as F,f as c,Z as M,g as E,h as Z,r as g,o as j,c as q,d as u,w as p,b as y,aE as G}from"./index-04865497.js";import{s}from"./index-b27b16a4.js";const H={class:"dorm-electricity-alert"},J={__name:"DormElectricityAlertEdit",setup(K){const A=Array.isArray(R)?R:[],h=A.map(n=>{const e=(n==null?void 0:n.name)||(n==null?void 0:n.text)||"",o=(n==null?void 0:n.value)!=null?String(n.value):"";return e&&o?{text:e,value:o}:null}).filter(Boolean),i=c(!1),a=c(!1),f=c(!1),v=c([]),m=c(!1),b=c(!1);let V=0;const r=M({campusName:"",campusValue:"",buildingName:"",buildingValue:"",roomName:"",roomValue:""});let x=!0;const B=E(()=>r.campusValue?r.buildingValue?m.value?"房间加载中...":b.value&&v.value.length===0?"暂无房间数据":"请选择房间":"请先选择楼栋":"请先选择校区"),C=E(()=>{const n=A.find(e=>String((e==null?void 0:e.value)??"")===r.campusValue);return n?(n.buildings||[]).map(e=>{const o=(e==null?void 0:e.name)||(e==null?void 0:e.text)||"",t=(e==null?void 0:e.value)!=null?String(e.value):"";return o&&t?{text:o,value:t}:null}).filter(Boolean):[]});function k(){r.roomName="",r.roomValue="",v.value=[],b.value=!1}function S(n){const e=Array.isArray(n==null?void 0:n.selectedOptions)?n.selectedOptions[0]:n;r.campusName=(e==null?void 0:e.text)||"",r.campusValue=(e==null?void 0:e.value)||"",i.value=!1,r.buildingName="",r.buildingValue="",k()}function U(n){const e=Array.isArray(n==null?void 0:n.selectedOptions)?n.selectedOptions[0]:n;r.buildingName=(e==null?void 0:e.text)||"",r.buildingValue=(e==null?void 0:e.value)||"",a.value=!1,k(),a.value&&O()}function P(n){const e=Array.isArray(n==null?void 0:n.selectedOptions)?n.selectedOptions[0]:n;r.roomName=(e==null?void 0:e.text)||"",r.roomValue=(e==null?void 0:e.value)||"",f.value=!1}function D(){if(!r.campusValue)return s("请先选择校区");if(!r.buildingValue)return s("请先选择楼栋");!b.value&&!m.value&&O(),f.value=!0}function L(){if(!r.campusValue){s("请先选择校区");return}if(C.value.length===0){s("当前校区暂无楼栋数据");return}a.value=!0}const T=async()=>{if(!r.roomValue)return s("请先选择房间");const n=await _.updateRoom({campus:r.campusValue,campusName:r.campusName,building:r.buildingValue,buildingName:r.buildingName,room:r.roomValue,roomName:r.roomName},{loading:"修改中..."});s(n)};async function O(){if(!r.campusValue||!r.buildingValue)return;const n=++V;m.value=!0;try{const e=await _.rooms(r.campusValue,r.buildingValue);if(V!==n)return;const o=$(e);v.value=o}catch(e){V===n&&(v.value=[],e!=null&&e.message&&s(e.message))}finally{V===n&&(m.value=!1,b.value=!0)}}function $(n){return I(n).map(o=>{const t=(o==null?void 0:o.text)||(o==null?void 0:o.name)||(o==null?void 0:o.label)||(o==null?void 0:o.roomName)||"",w=(o==null?void 0:o.value)??(o==null?void 0:o.code)??(o==null?void 0:o.id)??(o==null?void 0:o.roomId)??(typeof(o==null?void 0:o.text)=="string"?o.text:"")??(typeof(o==null?void 0:o.name)=="string"?o.name:""),d=w!=null?String(w):"";return{text:t,value:d}}).filter(o=>o.text&&o.value!=="")}function I(n){return Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.list)?n.list:Array.isArray(n==null?void 0:n.rows)?n.rows:Array.isArray(n==null?void 0:n.records)?n.records:[]}const z=async()=>{try{x=!0;const n=await _.viewRoom({loading:"加载中"});r.roomName=n.roomName,r.roomValue=n.room,r.buildingValue=n.building,r.buildingName=n.buildingName,r.campusName=n.campusName,r.campusValue=n.campus,console.log(r),x=!1}finally{}};return Z(async()=>{await z()}),(n,e)=>{const o=g("van-field"),t=g("van-button"),w=g("van-cell-group"),d=g("van-picker"),N=g("van-popup");return j(),q("div",H,[u(w,{inset:"",class:"dorm-electricity-alert__group"},{default:p(()=>[u(o,{modelValue:r.campusName,"onUpdate:modelValue":e[0]||(e[0]=l=>r.campusName=l),label:"校区",placeholder:"请选择校区","is-link":"",readonly:"",onClick:e[1]||(e[1]=l=>i.value=!0)},null,8,["modelValue"]),u(o,{modelValue:r.buildingName,"onUpdate:modelValue":e[2]||(e[2]=l=>r.buildingName=l),label:"楼栋",placeholder:"请选择楼栋","is-link":"",readonly:"",onClick:L},null,8,["modelValue"]),u(o,{modelValue:r.roomName,"onUpdate:modelValue":e[3]||(e[3]=l=>r.roomName=l),label:"房间",placeholder:B.value,"is-link":"",readonly:"",onClick:D},null,8,["modelValue","placeholder"]),u(t,{type:"primary",class:"dorm-electricity-alert__submit",onClick:T},{default:p(()=>[...e[10]||(e[10]=[y(" 保存修改 ",-1)])]),_:1})]),_:1}),u(N,{show:i.value,"onUpdate:show":e[5]||(e[5]=l=>i.value=l),round:"",position:"bottom"},{default:p(()=>[u(d,{title:"选择校区",columns:G(h),"show-toolbar":"",onConfirm:S,onCancel:e[4]||(e[4]=l=>i.value=!1)},null,8,["columns"])]),_:1},8,["show"]),u(N,{show:a.value,"onUpdate:show":e[7]||(e[7]=l=>a.value=l),round:"",position:"bottom"},{default:p(()=>[u(d,{title:"选择楼栋",columns:C.value,"show-toolbar":"",onConfirm:U,onCancel:e[6]||(e[6]=l=>a.value=!1)},null,8,["columns"])]),_:1},8,["show"]),u(N,{show:f.value,"onUpdate:show":e[9]||(e[9]=l=>f.value=l),round:"",position:"bottom"},{default:p(()=>[u(d,{title:"选择房间",columns:v.value,loading:m.value,"show-toolbar":"",onConfirm:P,onCancel:e[8]||(e[8]=l=>f.value=!1)},null,8,["columns","loading"])]),_:1},8,["show"])])}}},ee=F(J,[["__scopeId","data-v-b9f7f55e"]]);export{ee as default};
