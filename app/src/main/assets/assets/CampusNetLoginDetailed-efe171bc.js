import{S as p}from"./ServiceCampusNetLoginController-0a4f6d59.js";import{_ as F,f as r,g as N,h as I,r as m,o as _,c as f,a,X as v,d as s,w as i,b as g,U as P,V as Y,aE as j,Z as G}from"./index-3fbeb961.js";import{s as K,a as X}from"./function-call-454ef6b6.js";import"./index-ef797bb0.js";import{s as l}from"./index-a46618ff.js";const Z={class:"detailed-page"},q={class:"section logs-section"},J={class:"section__header"},Q={style:{"font-size":"12px",color:"#8fa1c1"}},W={class:"section__actions"},ee={class:"log-box",role:"log","aria-label":"服务日志"},te={class:"log-head"},oe={class:"time"},ae={key:0,class:"log-body"},ne={key:1,class:"log-empty"},se={class:"section actions-section"},ie={class:"actions"},le={class:"schedule-row"},re="campus_net_login_time",ce={__name:"CampusNetLoginDetailed",setup(ue){const k=r([]);function L(e){return!e||typeof e!="object"?{}:{id:e.id,relationTable:e.relationTable??e.relation_table,email:e.email,createTime:e.createTime??e.create_time,operationName:e.operationName??e.operation_name,operationStatus:e.operationStatus??e.operation_status,remarks:e.remarks}}const T=N(()=>(k.value||[]).map(L));function $(e){if(!e)return"";const t=typeof e=="string"||typeof e=="number"?new Date(e):e;if(!(t instanceof Date)||isNaN(t.getTime()))return String(e);const n=d=>String(d).padStart(2,"0");return`${t.getFullYear()}-${n(t.getMonth()+1)}-${n(t.getDate())} ${n(t.getHours())}:${n(t.getMinutes())}:${n(t.getSeconds())}`}function x(e){return e===1||e===!0?"成功":e===0||e===!1?"失败":""}function D(e){return e===1||e===!0?"ok":e===0||e===!1?"fail":""}async function b(){const e=await p.logs({loading:"加载中"});k.value=Array.isArray(e)?e:[]}async function y(){try{await b(),l("已刷新日志")}catch{l("刷新失败，请稍后重试")}}async function V(){try{await p.connect({loading:"连接中"}),l("连接操作已发送，请查看日志"),await y()}catch{l("连接失败，请稍后重试")}}async function E(){try{await K({title:"确认下线",message:"确定要下线校园网吗？当前连接将被断开。",confirmButtonText:"下线",cancelButtonText:"取消"})}catch{return}try{await p.logout({loading:"下线中"}),l("下线操作已发送，请查看日志"),await y()}catch{l("下线失败，请稍后重试")}}const c=r(!1),h=r("");N(()=>h.value?`每日 ${h.value}`:"未设置");const C=r(!1);function z(){c.value=!0}async function B(e){const t=e.selectedOptions[0].value,n=e.selectedOptions[1].value,d=await p.setRunningTime(t,n,{loading:"设置中"});l(d),c.value=!1,await S()}function M(){try{const e=localStorage.getItem(re);typeof e=="string"&&/^\d{2}:\d{2}$/.test(e)&&(h.value=e)}catch{}}const U=["hour","minute"],u=r(),H=()=>{X({title:"帮助",message:"该服务通过“自动下线校园网再上线”的方式，来刷新校园网在线时长。一般情况下，校园网会在上一次连接成功后约 48 小时自动断开连接。可设置刷新间隔来防止断线。"}).then(()=>{})},w=r(),S=async()=>{const t=(await p.view({loading:"加载中"})).refreshTime.split("-");u.value=[t[0],t[1]],w.value=`重置登录时间为每天的${u.value[0]}:${u.value[1]}`};return I(async()=>{await b(),M(),await S()}),(e,t)=>{const n=m("van-button"),d=m("van-tag"),O=m("van-popover"),A=m("van-time-picker"),R=m("van-popup");return _(),f("div",Z,[a("div",q,[a("div",J,[t[5]||(t[5]=a("div",{class:"section__title"},"服务日志",-1)),a("div",Q,v(w.value),1),a("div",W,[s(n,{size:"small",plain:"",type:"primary",onClick:y},{default:i(()=>[...t[4]||(t[4]=[g("刷新",-1)])]),_:1})])]),a("div",ee,[T.value.length?(_(!0),f(P,{key:0},Y(T.value,o=>(_(),f("div",{class:"log-item",key:o.id||o.createTime+"-"+o.operationName},[a("div",te,[a("span",oe,v($(o.createTime)),1),s(d,{class:"op-name-tag",type:"primary",size:"small",plain:""},{default:i(()=>[g(v(o.operationName),1)]),_:2},1024),a("span",{class:j(["status",D(o.operationStatus)])},v(x(o.operationStatus)),3)]),o.remarks?(_(),f("div",ae,v(o.remarks),1)):G("",!0)]))),128)):(_(),f("div",ne,"暂无日志"))])]),a("div",se,[a("div",ie,[s(n,{type:"primary",block:"",round:"",onClick:V},{default:i(()=>[...t[6]||(t[6]=[g("连接校园网",-1)])]),_:1}),s(n,{type:"danger",block:"",round:"",onClick:E},{default:i(()=>[...t[7]||(t[7]=[g("下线校园网",-1)])]),_:1}),a("div",le,[s(n,{type:"default",block:"",round:"",onClick:z},{default:i(()=>[...t[8]||(t[8]=[g(" 设置重置登录时间 ",-1)])]),_:1}),s(O,{show:C.value,"onUpdate:show":t[0]||(t[0]=o=>C.value=o),placement:"bottom",overlay:!1,trigger:"click"},{reference:i(()=>[a("span",{class:"help-badge","aria-label":"功能说明",onClick:H},"?")]),_:1},8,["show"])])])]),s(R,{show:c.value,"onUpdate:show":t[3]||(t[3]=o=>c.value=o),round:"",position:"bottom"},{default:i(()=>[s(A,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o),title:"选择刷新时间·每天","columns-type":U,"show-toolbar":"",onConfirm:B,onCancel:t[2]||(t[2]=o=>c.value=!1)},null,8,["modelValue"])]),_:1},8,["show"])])}}},ve=F(ce,[["__scopeId","data-v-827b5c42"]]);export{ve as default};
