import{_ as I,f as r,r as p,o as S,c as h,a as f,d as l,w as i,Y as A,b,X as F,e as U,B as N}from"./index-3fbeb961.js";import{s as o,U as y,F as T,C as q}from"./index-a46618ff.js";import{F as z}from"./index-7717884e.js";const D={class:"login-page"},E={class:"form-actions"},G={__name:"App",setup(M){const t=r(""),d=r(""),n=r(!1),s=r(!1),u=r(60);let m=null;const w=[{required:!0,message:"请填写邮箱"},{validator:e=>/.+@.+\..+/.test(e),message:"邮箱格式不正确"}];function C(e=60){u.value=e,s.value=!0,clearInterval(m),m=setInterval(()=>{u.value<=1?(clearInterval(m),s.value=!1,u.value=60):u.value-=1},1e3)}async function V(){if(!/.+@.+\..+/.test(t.value)){o("请先填写有效邮箱");return}if(!(s.value||n.value))try{n.value=!0;const e=await y.sendLoginCode(t.value);console.log(e),o("验证码已发送"),C(60)}catch(e){o((e==null?void 0:e.message)||"发送失败，请稍后重试")}finally{n.value=!1}}async function x(){if(!/.+@.+\..+/.test(t.value))return o("请填写有效邮箱");if(!d.value)return o("请填写验证码");try{const a=(await y.login(t.value,d.value)).token;localStorage.setItem("token",a),window.location.href="index.html"}catch(e){o((e==null?void 0:e.message)||"登录失败，请检查验证码")}}return(e,a)=>{const _=p("van-field"),g=p("van-button"),k=p("van-cell-group"),B=p("van-form");return S(),h("main",D,[a[3]||(a[3]=f("h1",{class:"title"},"邮箱验证码登录",-1)),l(B,{onSubmit:x,class:"form-wrap"},{default:i(()=>[l(k,null,{default:i(()=>[l(_,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=v=>t.value=v),name:"email",label:"邮箱",type:"text",placeholder:"请输入邮箱",clearable:"",rules:w},null,8,["modelValue"]),l(_,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=v=>d.value=v),name:"code",label:"验证码",type:"number",maxlength:"6",placeholder:"请输入收到的验证码",clearable:""},{button:i(()=>[l(g,{size:"small",type:"primary",loading:n.value,disabled:s.value||n.value,onClick:A(V,["prevent"])},{default:i(()=>[b(F(s.value?`${u.value}s`:"发送验证码"),1)]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"])]),_:1}),f("div",E,[l(g,{round:"",block:"",type:"primary","native-type":"submit"},{default:i(()=>[...a[2]||(a[2]=[b("登录",-1)])]),_:1})])]),_:1}),a[4]||(a[4]=f("p",{class:"tips"},"登录即表示同意并遵守相关条款。",-1))])}}},L=I(G,[["__scopeId","data-v-380273f6"]]),c=U(L);c.use(z);c.use(T);c.use(q);c.use(N);c.mount("#app");
