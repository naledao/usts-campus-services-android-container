import{q as le,l as pe,J as K,m as me,K as ie,t as ee,d as e,v as fe,x as ve,R as Q,I as ge,N as he,O as _e,z as re,T as ye,g as we,r as k,o as $,c as U,U as te,V as ne,i as ce,a as l,W as ae,b as I,X as q,w,Y as _,_ as ue,f as A,h as xe,u as ke,Z as be,e as Ce,B as Fe}from"./index-3fbeb961.js";import{v as Se,D as Ee,P as De}from"./index-ef797bb0.js";import{p as Te,b as Pe,P as Ae,c as $e,h as Z,s as z,U as Ie,F as Be,d as Ge,C as Me}from"./index-a46618ff.js";import{s as de}from"./function-call-454ef6b6.js";import{T as ze}from"./index-13ee653e.js";const[Ne,x]=le("action-sheet"),Ue=pe({},Te,{title:String,round:K,actions:me(),closeIcon:ie("cross"),closeable:K,cancelText:String,description:String,closeOnPopstate:K,closeOnClickAction:Boolean,safeAreaInsetBottom:K}),Le=[...Pe,"round","closeOnPopstate","safeAreaInsetBottom"];var Ve=ee({name:Ne,props:Ue,emits:["select","cancel","update:show"],setup(d,{slots:a,emit:f}){const g=o=>f("update:show",o),E=()=>{g(!1),f("cancel")},c=()=>{if(d.title)return e("div",{class:x("header")},[d.title,d.closeable&&e(Q,{name:d.closeIcon,class:[x("close"),ge],onClick:E},null)])},s=()=>{if(a.cancel||d.cancelText)return[e("div",{class:x("gap")},null),e("button",{type:"button",class:x("cancel"),onClick:E},[a.cancel?a.cancel():d.cancelText])]},p=o=>{if(o.icon)return e(Q,{class:x("item-icon"),name:o.icon},null)},h=(o,D)=>o.loading?e(he,{class:x("loading-icon")},null):a.action?a.action({action:o,index:D}):[e("span",{class:x("name")},[o.name]),o.subname&&e("div",{class:x("subname")},[o.subname])],b=(o,D)=>{const{color:B,loading:y,callback:T,disabled:P,className:i}=o,v=()=>{P||y||(T&&T(o),d.closeOnClickAction&&g(!1),_e(()=>f("select",o,D)))};return e("button",{type:"button",style:{color:B},class:[x("item",{loading:y,disabled:P}),i],onClick:v},[p(o),h(o,D)])},C=()=>{if(d.description||a.description){const o=a.description?a.description():d.description;return e("div",{class:x("description")},[o])}};return()=>e(Ae,fe({class:x(),position:"bottom","onUpdate:show":g},ve(d,Le)),{default:()=>{var o;return[c(),C(),e("div",{class:x("content")},[d.actions.map(b),(o=a.default)==null?void 0:o.call(a)]),s()]}})}});const Oe=re(Ve),[Re,Y]=le("empty"),He={image:ie("default"),imageSize:[Number,String,Array],description:String};var Ke=ee({name:Re,props:He,setup(d,{slots:a}){const f=()=>{const i=a.description?a.description():d.description;if(i)return e("p",{class:Y("description")},[i])},g=()=>{if(a.default)return e("div",{class:Y("bottom")},[a.default()])},E=$e(),c=i=>`${E}-${i}`,s=i=>`url(#${c(i)})`,p=(i,v,L)=>e("stop",{"stop-color":i,offset:`${v}%`,"stop-opacity":L},null),h=(i,v)=>[p(i,0),p(v,100)],b=i=>[e("defs",null,[e("radialGradient",{id:c(i),cx:"50%",cy:"54%",fx:"50%",fy:"54%",r:"297%",gradientTransform:"matrix(-.16 0 0 -.33 .58 .72)","data-allow-mismatch":"attribute"},[p("#EBEDF0",0),p("#F2F3F5",100,.3)])]),e("ellipse",{fill:s(i),opacity:".8",cx:"80",cy:"140",rx:"46",ry:"8","data-allow-mismatch":"attribute"},null)],C=()=>[e("defs",null,[e("linearGradient",{id:c("a"),x1:"64%",y1:"100%",x2:"64%","data-allow-mismatch":"attribute"},[p("#FFF",0,.5),p("#F2F3F5",100)])]),e("g",{opacity:".8","data-allow-mismatch":"children"},[e("path",{d:"M36 131V53H16v20H2v58h34z",fill:s("a")},null),e("path",{d:"M123 15h22v14h9v77h-31V15z",fill:s("a")},null)])],o=()=>[e("defs",null,[e("linearGradient",{id:c("b"),x1:"64%",y1:"97%",x2:"64%",y2:"0%","data-allow-mismatch":"attribute"},[p("#F2F3F5",0,.3),p("#F2F3F5",100)])]),e("g",{opacity:".8","data-allow-mismatch":"children"},[e("path",{d:"M87 6c3 0 7 3 8 6a8 8 0 1 1-1 16H80a7 7 0 0 1-8-6c0-4 3-7 6-7 0-5 4-9 9-9Z",fill:s("b")},null),e("path",{d:"M19 23c2 0 3 1 4 3 2 0 4 2 4 4a4 4 0 0 1-4 3v1h-7v-1l-1 1c-2 0-3-2-3-4 0-1 1-3 3-3 0-2 2-4 4-4Z",fill:s("b")},null)])],D=()=>e("svg",{viewBox:"0 0 160 160"},[e("defs",{"data-allow-mismatch":"children"},[e("linearGradient",{id:c(1),x1:"64%",y1:"100%",x2:"64%"},[p("#FFF",0,.5),p("#F2F3F5",100)]),e("linearGradient",{id:c(2),x1:"50%",x2:"50%",y2:"84%"},[p("#EBEDF0",0),p("#DCDEE0",100,0)]),e("linearGradient",{id:c(3),x1:"100%",x2:"100%",y2:"100%"},[h("#EAEDF0","#DCDEE0")]),e("radialGradient",{id:c(4),cx:"50%",cy:"0%",fx:"50%",fy:"0%",r:"100%",gradientTransform:"matrix(0 1 -.54 0 .5 -.5)"},[p("#EBEDF0",0),p("#FFF",100,0)])]),e("g",{fill:"none"},[C(),e("path",{fill:s(4),d:"M0 139h160v21H0z","data-allow-mismatch":"attribute"},null),e("path",{d:"M80 54a7 7 0 0 1 3 13v27l-2 2h-2a2 2 0 0 1-2-2V67a7 7 0 0 1 3-13z",fill:s(2),"data-allow-mismatch":"attribute"},null),e("g",{opacity:".6","stroke-linecap":"round","stroke-width":"7","data-allow-mismatch":"children"},[e("path",{d:"M64 47a19 19 0 0 0-5 13c0 5 2 10 5 13",stroke:s(3)},null),e("path",{d:"M53 36a34 34 0 0 0 0 48",stroke:s(3)},null),e("path",{d:"M95 73a19 19 0 0 0 6-13c0-5-2-9-6-13",stroke:s(3)},null),e("path",{d:"M106 84a34 34 0 0 0 0-48",stroke:s(3)},null)]),e("g",{transform:"translate(31 105)"},[e("rect",{fill:"#EBEDF0",width:"98",height:"34",rx:"2"},null),e("rect",{fill:"#FFF",x:"9",y:"8",width:"80",height:"18",rx:"1.1"},null),e("rect",{fill:"#EBEDF0",x:"15",y:"12",width:"18",height:"6",rx:"1.1"},null)])])]),B=()=>e("svg",{viewBox:"0 0 160 160"},[e("defs",{"data-allow-mismatch":"children"},[e("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:c(5)},[h("#F2F3F5","#DCDEE0")]),e("linearGradient",{x1:"95%",y1:"48%",x2:"5.5%",y2:"51%",id:c(6)},[h("#EAEDF1","#DCDEE0")]),e("linearGradient",{y1:"45%",x2:"100%",y2:"54%",id:c(7)},[h("#EAEDF1","#DCDEE0")])]),C(),o(),e("g",{transform:"translate(36 50)",fill:"none"},[e("g",{transform:"translate(8)"},[e("rect",{fill:"#EBEDF0",opacity:".6",x:"38",y:"13",width:"36",height:"53",rx:"2"},null),e("rect",{fill:s(5),width:"64",height:"66",rx:"2","data-allow-mismatch":"attribute"},null),e("rect",{fill:"#FFF",x:"6",y:"6",width:"52",height:"55",rx:"1"},null),e("g",{transform:"translate(15 17)",fill:s(6),"data-allow-mismatch":"attribute"},[e("rect",{width:"34",height:"6",rx:"1"},null),e("path",{d:"M0 14h34v6H0z"},null),e("rect",{y:"28",width:"34",height:"6",rx:"1"},null)])]),e("rect",{fill:s(7),y:"61",width:"88",height:"28",rx:"1","data-allow-mismatch":"attribute"},null),e("rect",{fill:"#F7F8FA",x:"29",y:"72",width:"30",height:"6",rx:"1"},null)])]),y=()=>e("svg",{viewBox:"0 0 160 160"},[e("defs",null,[e("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:c(8),"data-allow-mismatch":"attribute"},[h("#EAEDF1","#DCDEE0")])]),C(),o(),b("c"),e("path",{d:"m59 60 21 21 21-21h3l9 9v3L92 93l21 21v3l-9 9h-3l-21-21-21 21h-3l-9-9v-3l21-21-21-21v-3l9-9h3Z",fill:s(8),"data-allow-mismatch":"attribute"},null)]),T=()=>e("svg",{viewBox:"0 0 160 160"},[e("defs",{"data-allow-mismatch":"children"},[e("linearGradient",{x1:"50%",y1:"100%",x2:"50%",id:c(9)},[h("#EEE","#D8D8D8")]),e("linearGradient",{x1:"100%",y1:"50%",y2:"50%",id:c(10)},[h("#F2F3F5","#DCDEE0")]),e("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:c(11)},[h("#F2F3F5","#DCDEE0")]),e("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:c(12)},[h("#FFF","#F7F8FA")])]),C(),o(),b("d"),e("g",{transform:"rotate(-45 113 -4)",fill:"none","data-allow-mismatch":"children"},[e("rect",{fill:s(9),x:"24",y:"52.8",width:"5.8",height:"19",rx:"1"},null),e("rect",{fill:s(10),x:"22.1",y:"67.3",width:"9.9",height:"28",rx:"1"},null),e("circle",{stroke:s(11),"stroke-width":"8",cx:"27",cy:"27",r:"27"},null),e("circle",{fill:s(12),cx:"27",cy:"27",r:"16"},null),e("path",{d:"M37 7c-8 0-15 5-16 12",stroke:s(11),"stroke-width":"3",opacity:".5","stroke-linecap":"round",transform:"rotate(45 29 13)"},null)])]),P=()=>{var i;if(a.image)return a.image();const v={error:y,search:T,network:D,default:B};return((i=v[d.image])==null?void 0:i.call(v))||e("img",{src:d.image},null)};return()=>e("div",{class:Y()},[e("div",{class:Y("image"),style:ye(d.imageSize)},[P()]),f(),g()])}});const Ze=re(Ke);class O{static all(a){return Z.get("/api/common-service",a)}static start(a,f){return Z.post(`/api/common-service/start?serviceTag=${a}`,f)}static stop(a,f){return Z.post(`/api/common-service/stop?serviceTag=${a}`,f)}static delete(a,f){return Z.post(`/api/common-service/delete?serviceTag=${a}`,f)}}const Ye={class:"common-service-item"},qe={class:"group-title"},Je={class:"group-chip"},We=["onPointerdown","onPointerup"],Xe={class:"title-wrap"},je={class:"title-text"},Qe={class:"actions"},et={class:"status"},tt={class:"btns"},nt=550,oe=280,at=ee({__name:"CommonServiceItem",props:{services:{}},emits:["refresh"],setup(d,{emit:a}){const f=d,g=a,E=we(()=>{const n=new Map;for(const t of f.services||[]){const m=(t==null?void 0:t.tag)||"未分组";n.has(m)||n.set(m,[]),n.get(m).push(t)}return Array.from(n.entries()).map(([t,m])=>({tag:t,items:m}))});function c(n){const t=["#1989fa","#07c160","#ff976a","#ee0a24","#646cff","#7232dd"],m=n||"default";let F=0;for(let M=0;M<m.length;M++)F=(F+m.charCodeAt(M))%997;return t[F%t.length]}function s(n){const t=(n||"").toLowerCase();return t.includes("run")||t.includes("运行")||t.includes("active")?"success":t.includes("stop")||t.includes("停止")||t.includes("error")||t.includes("fail")?"danger":"primary"}function p(n){const t=s(n);return t==="success"?"#07c160":t==="danger"?"#ee0a24":"#1989fa"}function h(n,t){const m=n||"";return t?m.includes("停")?`已停止 ${t}`:m.toLowerCase().includes("run")||m.includes("运行")?`已运行 ${t}`:`运行时长：${t}`:"运行时长：-"}function b(n){const t=(n||"").toLowerCase();return t.includes("run")||t.includes("运行")||t.includes("active")}function C(n){const t=(n||"").toLowerCase();return t.includes("stop")||t.includes("停止")||t.includes("error")||t.includes("fail")}async function o(n){const t=await O.start(n.tag,{loading:"启动服务中"});g("refresh"),z(t)}async function D(n){const t=await O.stop(n.tag,{loading:"停止服务中"});g("refresh"),z(t)}async function B(n){const t=await O.start(n.tag,{loading:"重启服务中"});g("refresh"),z(t)}let y=null,T=!1,P=0,i="",v=null;function L(n){return`${n.tag||""}__${n.name}`}function J(n){T=!1,clearTimeout(y),y=setTimeout(()=>{T=!0,R(n)},nt)}function W(n){if(clearTimeout(y),T)return;const t=Date.now(),m=L(n);t-P<=oe&&i===m?(P=0,i="",v&&(clearTimeout(v),v=null),window.location.href="edit.html?code="+G(n.tag)):(P=t,i=m,v&&clearTimeout(v),v=setTimeout(()=>{u(n)},oe+20))}const G=n=>{switch(n){case"校园网自动登录":return"campus_net_login"}};function V(){clearTimeout(y)}async function R(n){try{await de({title:"确认删除",message:`确定要删除“${(n==null?void 0:n.name)||""}”吗？`,confirmButtonText:"删除",cancelButtonText:"取消"});const t=O.delete(n.tag,{loading:"删除中"});z(t),g("refresh")}catch{}}const u=n=>{window.location.href="detailed.html?code="+G(n.tag)};return(n,t)=>{const m=k("van-tag"),F=k("van-button"),M=k("van-cell"),X=k("van-cell-group"),j=k("van-empty");return $(),U("div",Ye,[E.value.length?($(!0),U(te,{key:0},ne(E.value,N=>($(),U("div",{class:"group",key:N.tag},[l("div",qe,[l("span",Je,[l("i",{class:"chip-dot",style:ae({backgroundColor:c(N.tag)})},null,4),I(" "+q(N.tag),1)])]),e(X,{inset:""},{default:w(()=>[($(!0),U(te,null,ne(N.items,r=>($(),U("div",{class:"cell-wrapper",key:r.name+"_"+(r.tag||""),onPointerdown:H=>J(r),onPointerup:H=>W(r),onPointercancel:V,onPointerleave:V},[e(M,{label:h(r.runStatus,r.runningTime)},{title:w(()=>[l("div",Xe,[l("span",{class:"status-dot",style:ae({backgroundColor:p(r.runStatus)})},null,4),l("span",je,q(r.name),1)])]),"right-icon":w(()=>[l("div",Qe,[l("div",et,[e(m,{type:s(r.runStatus),size:"small"},{default:w(()=>[I(q(r.runStatus||"未知状态"),1)]),_:2},1032,["type"])]),l("div",tt,[e(F,{size:"small",type:"primary",round:"",plain:"",icon:"play",disabled:!C(r.runStatus),onClick:_(H=>o(r),["stop"]),onDblclick:t[0]||(t[0]=_(()=>{},["stop"])),onPointerup:t[1]||(t[1]=_(()=>{},["stop"])),onPointerdown:t[2]||(t[2]=_(()=>{},["stop"]))},{default:w(()=>[...t[9]||(t[9]=[I("运行",-1)])]),_:1},8,["disabled","onClick"]),e(F,{size:"small",type:"danger",round:"",plain:"",icon:"stop",disabled:!b(r.runStatus),onClick:_(H=>D(r),["stop"]),onDblclick:t[3]||(t[3]=_(()=>{},["stop"])),onPointerup:t[4]||(t[4]=_(()=>{},["stop"])),onPointerdown:t[5]||(t[5]=_(()=>{},["stop"]))},{default:w(()=>[...t[10]||(t[10]=[I("停止",-1)])]),_:1},8,["disabled","onClick"]),e(F,{size:"small",type:"warning",round:"",plain:"",icon:"replay",onClick:_(H=>B(r),["stop"]),onDblclick:t[6]||(t[6]=_(()=>{},["stop"])),onPointerup:t[7]||(t[7]=_(()=>{},["stop"])),onPointerdown:t[8]||(t[8]=_(()=>{},["stop"]))},{default:w(()=>[...t[11]||(t[11]=[I("重启",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["label"])],40,We))),128))]),_:2},1024)]))),128)):($(),ce(j,{key:1,"image-size":"64",description:"暂无服务"}))])}}});const ot=ue(at,[["__scopeId","data-v-21cd5caa"]]);const st={class:"page"},lt={class:"top-bar"},it={class:"user-area"},rt={class:"actions"},ct={class:"content"},se="index_service_ops_guide_shown",ut={__name:"App",setup(d){const a=A(""),f=A(!1),g=A(""),E=A(!1),c=[{text:"退出登录"}],s=A(!1),p=[{name:"校园网自动登录",code:"campus_net_login",subname:"自动连接校园网"},{name:"宿舍电费预期",code:"ac_repair",subname:"未实现"}];function h(){try{a.value=localStorage.getItem("nickname")||""}catch{a.value=""}}const b=A(!1),C=A(!1);function o(){try{return C.value||localStorage.getItem(se)==="1"}catch{return!0}}function D(){try{localStorage.setItem(se,"1")}catch{}}function B(){var u;(u=G.value)!=null&&u.length&&(o()||(b.value=!0))}function y(){b.value=!1,C.value=!0,D()}function T(){g.value=a.value||"",f.value=!0}const P=async()=>{const u=(g.value||"").trim();if(!u)return z("请输入昵称"),!1;a.value=u;try{(await Ie.updateNickname({nickname:u})).nickname?localStorage.setItem("nickname",u):z("昵称修改失败")}catch{}return z("已更新昵称"),!0};function i(){s.value=!0}function v(u){const n=u==null?void 0:u.code;n&&(window.location.href=`create.html?code=${encodeURIComponent(n)}`)}function L(){try{localStorage.removeItem("token"),localStorage.removeItem("nickname")}catch{}window.location.href="login.html"}async function J(){try{await de({title:"确认退出",message:"确定要退出登录吗？",confirmButtonText:"退出登录",cancelButtonText:"取消"}),L()}catch{}}function W(u){((u==null?void 0:u.text)||"")==="退出登录"&&J()}const G=A([]),V=async()=>{G.value=await O.all()},R=async()=>{await Se(),h(),await V(),B()};return xe(R),ke(G,u=>{Array.isArray(u)&&u.length&&!o()&&(b.value=!0)}),(u,n)=>{const t=k("van-icon"),m=k("van-popover"),F=k("van-button"),M=k("van-field"),X=k("van-dialog"),j=k("van-action-sheet"),N=k("van-overlay");return $(),U("div",st,[l("header",lt,[l("div",it,[l("div",{class:"nickname",onClick:T},q(a.value||"点击设置昵称")+"，你好！ ",1),e(m,{show:E.value,"onUpdate:show":n[0]||(n[0]=r=>E.value=r),actions:c,placement:"bottom-start",theme:"light",onSelect:W},{reference:w(()=>[e(t,{name:"arrow-down",class:"user-arrow","aria-label":"打开用户菜单"})]),_:1},8,["show"])]),l("div",rt,[e(F,{class:"refresh-btn",type:"default",size:"small",icon:"replay","aria-label":"刷新页面",onClick:R},{default:w(()=>[...n[5]||(n[5]=[I(" 刷新 ",-1)])]),_:1}),e(F,{class:"create-btn",type:"primary",size:"small",icon:"plus","aria-label":"新建服务",onClick:i},{default:w(()=>[...n[6]||(n[6]=[I(" 新建服务 ",-1)])]),_:1})])]),l("section",ct,[e(ot,{services:G.value,onRefresh:V},null,8,["services"])]),e(X,{show:f.value,"onUpdate:show":n[2]||(n[2]=r=>f.value=r),title:"修改昵称","show-cancel-button":"",onConfirm:P},{default:w(()=>[e(M,{modelValue:g.value,"onUpdate:modelValue":n[1]||(n[1]=r=>g.value=r),label:"昵称",placeholder:"请输入新昵称",maxlength:"20",clearable:""},null,8,["modelValue"])]),_:1},8,["show"]),e(j,{show:s.value,"onUpdate:show":n[3]||(n[3]=r=>s.value=r),title:"选择要创建的服务",actions:p,"cancel-text":"取消","close-on-click-action":"",onSelect:v},null,8,["show"]),b.value?($(),ce(N,{key:0,"z-index":3e3,onClick:_(y,["self"])},{default:w(()=>[l("div",{class:"ops-guide",onClick:n[4]||(n[4]=_(()=>{},["stop"]))},[e(t,{name:"cross",class:"ops-guide__close",onClick:y}),n[8]||(n[8]=l("div",{class:"ops-guide__title"},"使用提示",-1)),n[9]||(n[9]=l("div",{class:"ops-guide__list"},[l("div",{class:"ops-guide__item"},[l("span",{class:"ops-guide__dot"},"•"),l("span",null,"单击：进入服务详情界面")]),l("div",{class:"ops-guide__item"},[l("span",{class:"ops-guide__dot"},"•"),l("span",null,"双击：进入服务编辑界面")]),l("div",{class:"ops-guide__item"},[l("span",{class:"ops-guide__dot"},"•"),l("span",null,"长按：进入删除操作")])],-1)),e(F,{type:"primary",block:"",round:"",onClick:y},{default:w(()=>[...n[7]||(n[7]=[I("我知道了",-1)])]),_:1}),n[10]||(n[10]=l("div",{class:"ops-guide__hint"},"点击空白处也可关闭",-1))])]),_:1})):be("",!0)])}}},dt=ue(ut,[["__scopeId","data-v-607db591"]]);const S=Ce(dt);S.use(Fe);S.use(Q);S.use(Ee);S.use(Be);S.use(De);S.use(Oe);S.use(Ge);S.use(Me);S.use(ze);S.use(Ze);S.mount("#app");
